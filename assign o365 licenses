#https://docs.microsoft.com/en-us/office365/enterprise/powershell/assign-licenses-to-user-accounts-with-office-365-powershell
#https://docs.microsoft.com/en-us/office365/enterprise/powershell/remove-licenses-from-user-accounts-with-office-365-powershell
#https://docs.microsoft.com/en-us/office365/enterprise/powershell/view-licenses-and-services-with-office-365-powershell
#https://docs.microsoft.com/en-us/office365/enterprise/powershell/disable-access-to-services-while-assigning-user-licenses
#https://docs.microsoft.com/en-us/office365/enterprise/powershell/disable-access-to-services-with-office-365-powershell

Connect-MsolService
Get-MsolAccountSku

#(Get-MsolAccountSku | where {$_.AccountSkuId -eq "quickmountpv:ENTERPRISEPACK"}).ServiceStatus
#Get-MsolAccountSku | select -ExpandProperty servicestatus

Get-ADUser -Filter {memberof -RecursiveMatch "CN=Online-Users,OU=QMPV-GROUPS,DC=quickmountpv,DC=com"} | Select-Object -Property UserPrincipalName | Set-MsolUserLicense -RemoveLicenses "quickmountpv:OFFICESUBSCRIPTION"
Get-ADUser -Filter {memberof -RecursiveMatch "CN=Online-Users,OU=QMPV-GROUPS,DC=quickmountpv,DC=com"} | Select-Object -Property UserPrincipalName | Set-MsolUserLicense -AddLicenses "quickmountpv:ENTERPRISEPACK"

$LO = New-MsolLicenseOptions -AccountSkuId quickmountpv:ENTERPRISEPACK -DisabledPlans "BPOS_S_TODO_2", "", "FORMS_PLAN_E3", "STREAM_O365_E3", "Deskless", "FLOW_O365_P2", "POWERAPPS_O365_P2", "PROJECTWORKMANAGEMENT", "SWAY", "YAMMER_ENTERPRISE", "SHAREPOINTENTERPRISE", "EXCHANGE_S_ENTERPRISE"

Get-ADUser -Filter {memberof -RecursiveMatch "CN=Online-Users,OU=QMPV-GROUPS,DC=quickmountpv,DC=com"} | Select-Object -Property UserPrincipalName | Set-MsolUserLicense -LicenseOptions $LO
